<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Peer Review & Collaboration — Student Platform (Demo)</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa6b2; --accent:#06b6d4; --glass: rgba(255,255,255,0.03);
      --success: #10b981; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071027 0%, #071827 100%);color:#e6eef6;min-height:100vh}
    .app{display:flex;gap:18px;padding:20px;max-width:1200px;margin:20px auto}
    .sidebar{width:260px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .brand{font-weight:700;font-size:18px;margin-bottom:12px}
    .nav{display:flex;flex-direction:column;gap:8px}
    .nav button{background:transparent;border:0;color:var(--muted);padding:10px;border-radius:8px;text-align:left;cursor:pointer}
    .nav button.active{background:var(--glass);color:#fbfdff}
    .main{flex:1}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .search{background:var(--card);padding:10px;border-radius:10px;display:flex;gap:8px;align-items:center}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:12px;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .project-list{display:flex;flex-direction:column;gap:10px}
    .project{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
    .btn{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#062023;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
    .muted{color:var(--muted);font-size:13px}
    .list{max-height:380px;overflow:auto;padding-right:6px}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:60}
    .modal.active{display:flex}
    .modal-card{width:720px;background:linear-gradient(180deg,#071827,#05121a);padding:18px;border-radius:12px}
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .row{display:flex;gap:8px}
    .col{flex:1}
    .small{font-size:13px;color:var(--muted)}
    .chip{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:13px}
    .review{border-left:3px solid rgba(6,182,212,0.2);padding-left:10px}
    footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:900px){.app{flex-direction:column;padding:12px}.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar card">
      <div class="brand">PeerReview • Student</div>
      <div class="muted">Demo platform — client-only prototype (localStorage)</div>
      <div style="height:12px"></div>
      <div class="nav" id="nav">
        <button class="active" data-view="dashboard">Dashboard</button>
        <button data-view="projects">Projects</button>
        <button data-view="submissions">Submissions</button>
        <button data-view="reviews">Review Queue</button>
        <button data-view="settings">Settings</button>
      </div>
      <div style="height:12px"></div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="btnNewProject">New Project</button>
        <button class="btn ghost" id="btnDemoData">Demo</button>
      </div>
      <div style="height:10px"></div>
      <div class="small">Logged in as <strong id="currentUser">student1</strong></div>
    </aside>

    <main class="main">
      <div class="header">
        <div class="search card">
          <input id="globalSearch" placeholder="Search projects, submissions, reviews..." style="flex:1;background:transparent;border:0;outline:none;color:inherit" />
          <div class="chip" id="filterCount">0</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="small">Role: <span class="chip">Student</span></div>
          <button class="btn ghost" id="btnExport">Export</button>
        </div>
      </div>

      <section id="viewArea">
        <!-- dynamic content rendered by JS -->
      </section>

      <footer>Built for demo — stores data in your browser. Try creating projects and peer reviews.</footer>
    </main>
  </div>

  <!-- Modals -->
  <div class="modal" id="modal">
    <div class="modal-card">
      <div id="modalContent"></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button class="btn ghost" id="modalCancel">Cancel</button>
        <button class="btn" id="modalSubmit">Save</button>
      </div>
    </div>
  </div>

  <script>
    // -------------------------------
    // Simple client-side data layer (localStorage)
    // -------------------------------
    const STORAGE_KEY = 'peerReview_demo_v1';
    const defaultState = {
      users: [{id:'student1', name:'Alice'}, {id:'student2', name:'Bob'}, {id:'student3', name:'Cathy'}],
      projects: [],
      submissions: [],
      reviews: []
    };

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) { localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultState)); return JSON.parse(JSON.stringify(defaultState)); }
        return JSON.parse(raw);
      }catch(e){console.error(e); localStorage.removeItem(STORAGE_KEY); return JSON.parse(JSON.stringify(defaultState));}
    }
    function saveState(state){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    let state = loadState();
    const currentUser = 'student1';

    // -------------------------------
    // Helpers
    // -------------------------------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    function uid(prefix='id'){return prefix+Math.random().toString(36).slice(2,9)}

    // -------------------------------
    // Rendering
    // -------------------------------
    function render(){
      $('#currentUser').textContent = currentUser;
      const view = $$('.nav button').find(b=>b.classList.contains('active'))?.dataset.view || 'dashboard';
      if(view === 'dashboard') renderDashboard();
      if(view === 'projects') renderProjects();
      if(view === 'submissions') renderSubmissions();
      if(view === 'reviews') renderReviews();
      if(view === 'settings') renderSettings();
    }

    function renderDashboard(){
      const el = document.getElementById('viewArea');
      el.innerHTML = `
        <div class="grid">
          <div class="card">
            <h3>Active Projects</h3>
            <div class="project-list list" id="projectList"></div>
          </div>
          <div class="card">
            <h3>Your Tasks</h3>
            <div class="list" id="taskList"></div>
          </div>
        </div>
        <div class="card" style="margin-top:12px">
          <h3>Recent Reviews</h3>
          <div class="list" id="recentReviews"></div>
        </div>
      `;

      // projects
      const pl = $('#projectList'); pl.innerHTML='';
      state.projects.forEach(p=>{
        const div = document.createElement('div'); div.className='project';
        div.innerHTML = `<div><strong>${p.title}</strong><div class='muted'>${p.description || ''}</div></div><div style='display:flex;gap:8px'>
          <button class='btn ghost' data-id='${p.id}' data-action='open'>Open</button>
          <button class='btn' data-id='${p.id}' data-action='join'>Join</button>
        </div>`;
        pl.appendChild(div);
      });

      // tasks: submissions assigned for review to current user
      const tasks = state.reviews.filter(r=>r.reviewer === currentUser && !r.completed);
      const tl = $('#taskList'); tl.innerHTML='';
      if(tasks.length===0) tl.innerHTML='<div class="muted">No pending reviews — great!</div>';
      tasks.forEach(t=>{
        const sub = state.submissions.find(s=>s.id===t.submissionId);
        const project = state.projects.find(pp=>pp.id===sub.projectId);
        const d = document.createElement('div'); d.className='project';
        d.innerHTML = `<div><strong>${sub.title}</strong><div class='muted'>Project: ${project.title}</div></div>
          <div><button class='btn' data-id='${t.id}' data-action='review'>Review</button></div>`;
        tl.appendChild(d);
      });

      // recent reviews
      const rv = $('#recentReviews'); rv.innerHTML='';
      const recent = state.reviews.slice(-6).reverse();
      if(recent.length===0) rv.innerHTML='<div class="muted">No reviews yet</div>';
      recent.forEach(r=>{
        const li = document.createElement('div'); li.className='project review';
        const sub = state.submissions.find(s=>s.id===r.submissionId) || {}; 
        li.innerHTML = <div><strong>${sub.title||'—'}</strong><div class='muted'>by ${sub.author || '—'} • score: ${r.score ?? '—'}</div></div><div class='muted'>${r.comment || ''}</div>;
        rv.appendChild(li);
      });
    }

    function renderProjects(){
      const el = document.getElementById('viewArea');
      el.innerHTML = `<div class='card'><div style='display:flex;justify-content:space-between;align-items:center'><h3>Projects</h3><div><button class='btn' id='btnCreateProject'>Create Project</button></div></div>
        <div class='list' id='projectsContainer'></div></div>`;
      const container = $('#projectsContainer'); container.innerHTML='';
      if(state.projects.length===0) container.innerHTML='<div class="muted">No projects yet. Create one!</div>';
      state.projects.forEach(p=>{
        const div = document.createElement('div'); div.className='project';
        div.innerHTML = `<div><strong>${p.title}</strong><div class='muted'>${p.description||''}</div></div>
          <div style='display:flex;gap:8px'>
            <button class='btn ghost' data-id='${p.id}' data-action='view'>View</button>
            <button class='btn' data-id='${p.id}' data-action='submit'>Submit</button>
          </div>`;
        container.appendChild(div);
      });
    }

    function renderSubmissions(){
      const el = document.getElementById('viewArea');
      el.innerHTML = <h3>Submissions</h3><div class='list' id='subs'></div>;
      const subs = $('#subs'); subs.innerHTML='';
      if(state.submissions.length===0) subs.innerHTML='<div class="muted">No submissions yet.</div>';
      state.submissions.slice().reverse().forEach(s=>{
        const p = state.projects.find(pp=>pp.id===s.projectId) || {title:'—'};
        const reviews = state.reviews.filter(r=>r.submissionId === s.id);
        const avg = reviews.length? (reviews.reduce((a,b)=>a+(b.score||0),0)/reviews.length).toFixed(1) : '—';
        const d = document.createElement('div'); d.className='project';
        d.innerHTML = `<div><strong>${s.title}</strong><div class='muted'>Project: ${p.title} • by ${s.author}</div></div>
          <div style='display:flex;flex-direction:column;gap:6px;align-items:flex-end'>
            <div class='muted'>Avg score: ${avg}</div>
            <div style='display:flex;gap:8px'>
              <button class='btn ghost' data-id='${s.id}' data-action='viewSub'>Open</button>
              <button class='btn' data-id='${s.id}' data-action='requestReview'>Request Review</button>
            </div>
          </div>`;
        subs.appendChild(d);
      });
    }

    function renderReviews(){
      const el = document.getElementById('viewArea');
      const myReviews = state.reviews.filter(r=>r.reviewer === currentUser);
      el.innerHTML = `<h3>Review Queue</h3>
        <div class='list' id='reviewList'></div>`;
      const rl = $('#reviewList'); rl.innerHTML='';
      if(state.reviews.length===0) rl.innerHTML='<div class="muted">No reviews scheduled.</div>';
      state.reviews.slice().reverse().forEach(r=>{
        const s = state.submissions.find(ss=>ss.id===r.submissionId) || {};
        const p = state.projects.find(pp=>pp.id===s.projectId) || {}; 
        const d = document.createElement('div'); d.className='project';
        d.innerHTML = `<div><strong>${s.title||'—'}</strong><div class='muted'>Project: ${p.title||'—'} • reviewer: ${r.reviewer}</div></div>
          <div style='display:flex;gap:8px'>
            <button class='btn' data-id='${r.id}' data-action='review'>Review</button>
            ${r.completed? '<div class="chip">Completed</div>' : ''}
          </div>`;
        rl.appendChild(d);
      });
    }

    function renderSettings(){
      const el = document.getElementById('viewArea');
      el.innerHTML = `<div class='card'><h3>Settings</h3>
        <div class='muted'>Demo settings</div>
        <div style='height:12px'></div>
        <div style='display:flex;gap:8px'><button class='btn' id='btnReset'>Reset Data</button><button class='btn ghost' id='btnClearReviews'>Clear Reviews</button></div>
      </div>`;
    }

    // -------------------------------
    // Event wiring
    // -------------------------------
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(btn && btn.dataset.view){
        $$('.nav button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active'); render(); return;
      }
      if(btn && btn.id === 'btnNewProject'){ openModal(projectForm()); return; }
      if(btn && btn.id === 'btnCreateProject'){ openModal(projectForm()); return; }
      if(btn && btn.id === 'btnDemoData'){ seedDemo(); render(); return; }
      if(btn && btn.id === 'btnExport'){ exportJSON(); return; }
      if(btn && btn.id === 'btnReset'){ if(confirm('Reset all demo data? This cannot be undone.')){ localStorage.removeItem(STORAGE_KEY); state = loadState(); render(); } return; }
      if(btn && btn.id === 'btnClearReviews'){ if(confirm('Clear all reviews?')){ state.reviews = []; saveState(state); render(); } return; }

      if(btn && btn.dataset.action){
        const action = btn.dataset.action; const id = btn.dataset.id;
        if(action === 'open' || action === 'view') { openProjectView(id); return; }
        if(action === 'join'){ alert('You joined the project — in a full app this would add you to members.'); return; }
        if(action === 'submit'){ openModal(submissionForm(id)); return; }
        if(action === 'viewSub'){ openSubmissionView(id); return; }
        if(action === 'requestReview'){ openModal(requestReviewForm(id)); return; }
        if(action === 'review'){ openModal(reviewForm(id)); return; }
      }
    });

    // modal controls
    $('#modalCancel').addEventListener('click', ()=>closeModal());
    $('#modalSubmit').addEventListener('click', ()=>{
      const cb = $('#modal').dataset.callback;
      if(cb && window[cb]){ try{ window[cb](); closeModal(); }catch(e){ console.error(e); alert('Action failed. See console.') } }
    });

    function openModal(html){ $('#modalContent').innerHTML = html; $('#modal').classList.add('active'); }
    function closeModal(){ $('#modal').classList.remove('active'); $('#modalContent').innerHTML=''; delete $('#modal').dataset.callback; }

    // -------------------------------
    // Forms
    // -------------------------------
    function projectForm(){
      const id = uid('proj');
      const html = `
        <h3>Create Project</h3>
        <label>Title<input type='text' id='proj_title' /></label>
        <label>Description<textarea id='proj_desc' rows='4'></textarea></label>
      `;
      $('#modal').dataset.callback = 'saveNewProject';
      return html;
    }
    function saveNewProject(){
      const t = $('#proj_title').value.trim(); const d = $('#proj_desc').value.trim();
      if(!t){ alert('Title required'); return; }
      const p = {id: uid('p'), title:t, description:d, createdAt:Date.now()};
      state.projects.push(p); saveState(state); render();
    }

    function submissionForm(projectId){
      const project = state.projects.find(p=>p.id===projectId) || {};
      const html = `
        <h3>New Submission — ${project.title || ''}</h3>
        <label>Title<input type='text' id='sub_title' /></label>
        <label>Summary<textarea id='sub_summary' rows='4' placeholder='Paste a link or a short summary'></textarea></label>
        <label>Content (short)<textarea id='sub_content' rows='6' placeholder='Write or paste your content'></textarea></label>
      `;
      $('#modal').dataset.callback = 'saveNewSubmission';
      $('#modal').dataset.projectId = projectId;
      return html;
    }
    function saveNewSubmission(){
      const title = $('#sub_title').value.trim(); const summary = $('#sub_summary').value.trim(); const content = $('#sub_content').value.trim();
      const projectId = $('#modal').dataset.projectId;
      if(!title){ alert('Title required'); return; }
      const sub = {id: uid('s'), title, summary, content, projectId, author:currentUser, createdAt:Date.now()};
      state.submissions.push(sub); saveState(state); render();
    }

    function requestReviewForm(submissionId){
      const submission = state.submissions.find(s=>s.id===submissionId) || {};
      const html = `
        <h3>Request Review — ${submission.title || ''}</h3>
        <label>Assign reviewer<select id='rv_reviewer'>${state.users.map(u=><option value='${u.id}'>${u.name} (${u.id})</option>).join('')}</select></label>
        <label>Priority<select id='rv_priority'><option value='normal'>Normal</option><option value='urgent'>Urgent</option></select></label>
        <label>Notes<textarea id='rv_notes' rows='3' placeholder='Any specific instructions for the reviewer'></textarea></label>
      `;
      $('#modal').dataset.callback = 'saveReviewRequest';
      $('#modal').dataset.submissionId = submissionId;
      return html;
    }
    function saveReviewRequest(){
      const reviewer = $('#rv_reviewer').value; const notes = $('#rv_notes').value; const submissionId = $('#modal').dataset.submissionId;
      const r = {id: uid('r'), submissionId, reviewer, notes, completed:false, createdAt:Date.now()};
      state.reviews.push(r); saveState(state); render();
    }

    function reviewForm(reviewIdOrSubmissionId){
      // parameter might be review.id (when coming from review list) or review.id (when task button). Detect
      let review = state.reviews.find(r=>r.id===reviewIdOrSubmissionId) || state.reviews.find(r=>r.submissionId===reviewIdOrSubmissionId) || null;
      let submission = review ? state.submissions.find(s=>s.id===review.submissionId) : state.submissions.find(s=>s.id===reviewIdOrSubmissionId);
      if(!submission){ submission = state.submissions.find(s=>s.id===reviewIdOrSubmissionId); }
      const html = `
        <h3>Write Review — ${submission.title || ''}</h3>
        <div class='muted'>Author: ${submission.author || '—'}</div>
        <label>Score (0-10)<input type='number' id='rv_score' min='0' max='10' /></label>
        <label>Comment<textarea id='rv_comment' rows='5'></textarea></label>
        <div class='small'>When you save, review will be marked completed.</div>
      `;
      // create a temp review if none
      if(!review){ review = {id:uid('rtemp'), submissionId:submission.id, reviewer:currentUser}; state.reviews.push(review); }
      $('#modal').dataset.callback = 'saveReview';
      $('#modal').dataset.reviewId = review.id;
      return html;
    }
    function saveReview(){
      const id = $('#modal').dataset.reviewId; const review = state.reviews.find(r=>r.id===id);
      const score = Number($('#rv_score').value || 0); const comment = $('#rv_comment').value.trim();
      review.score = score; review.comment = comment; review.completed = true; review.completedAt = Date.now();
      saveState(state); render();
    }

    function openProjectView(id){
      const p = state.projects.find(x=>x.id===id); if(!p){ alert('Project not found'); return; }
      const members = state.users.map(u=><span class='chip'>${u.name}</span>).join(' ');
      document.getElementById('viewArea').innerHTML = `<div class='card'><div style='display:flex;justify-content:space-between;align-items:center'><div><h3>${p.title}</h3><div class='muted'>${p.description || ''}</div></div><div>${members}</div></div>
        <div style='height:12px'></div>
        <div class='grid'><div class='card'><h4>Submissions</h4><div class='list' id='projSubs'></div></div>
        <div class='card'><h4>Actions</h4><div style='display:flex;flex-direction:column;gap:8px'><button class='btn' data-action='submit' data-id='${p.id}'>Submit Work</button><button class='btn ghost' id='btnProjInvite'>Invite</button></div></div></div></div>`;
      const cont = $('#projSubs'); cont.innerHTML = '';
      state.submissions.filter(s=>s.projectId===p.id).forEach(s=>{
        const div = document.createElement('div'); div.className='project'; div.innerHTML = `<div><strong>${s.title}</strong><div class='muted'>by ${s.author}</div></div>
          <div style='display:flex;gap:8px'><button class='btn ghost' data-action='viewSub' data-id='${s.id}'>Open</button><button class='btn' data-action='requestReview' data-id='${s.id}'>Request Review</button></div>`;
        cont.appendChild(div);
      });
    }

    function openSubmissionView(id){
      const s = state.submissions.find(x=>x.id===id); if(!s){ alert('Submission not found'); return; }
      const project = state.projects.find(p=>p.id===s.projectId) || {title:'—'};
      const reviews = state.reviews.filter(r=>r.submissionId===s.id);
      document.getElementById('viewArea').innerHTML = `<div class='card'><h3>${s.title}</h3><div class='muted'>Project: ${project.title} • by ${s.author}</div>
        <div style='height:10px'></div>
        <div>${s.summary ? <div><strong>Summary</strong><p class='muted'>${s.summary}</p></div> : ''}
        <div><strong>Content</strong><div style='white-space:pre-wrap' class='muted'>${s.content || ''}</div></div>
        <div style='height:12px'></div>
        <div><strong>Reviews</strong><div class='list' id='subReviews'></div></div>
        </div></div>`;
      const sr = $('#subReviews'); sr.innerHTML='';
      if(reviews.length===0) sr.innerHTML='<div class="muted">No reviews yet for this submission.</div>';
      reviews.forEach(r=>{
        const u = state.users.find(x=>x.id===r.reviewer) || {name:r.reviewer};
        const div = document.createElement('div'); div.className='project'; div.innerHTML = <div><strong>${u.name}</strong><div class='muted'>score: ${r.score ?? '—'}</div></div><div class='muted'>${r.comment || ''}</div>;
        sr.appendChild(div);
      });
    }

    // -------------------------------
    // Utility: demo seed & export
    // -------------------------------
    function seedDemo(){
      state = {
        users: [{id:'student1',name:'Alice'},{id:'student2',name:'Bob'},{id:'student3',name:'Cathy'}],
        projects: [{id:'p1',title:'AI Essay Review',description:'Peer review essays on ethical AI'}, {id:'p2',title:'Design Sprint',description:'Collaborative UI design task'}],
        submissions: [
          {id:'s1', projectId:'p1', title:'Essay on Bias', author:'student2', summary:'Exploring bias in models', content:'Long essay text...'},
          {id:'s2', projectId:'p2', title:'Landing Page Draft', author:'student3', summary:'Initial mockups', content:'Design notes and links...'}
        ],
        reviews: [ {id:'r1',submissionId:'s1',reviewer:'student1',score:8,comment:'Good structure',completed:true}, {id:'r2',submissionId:'s2',reviewer:'student1',score:7,comment:'Nice visual hierarchy',completed:true} ]
      };
      saveState(state); render();
    }

    function exportJSON(){
      const data = JSON.stringify(state,null,2);
      const blob = new Blob([data],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'peerreview-export.json'; a.click(); URL.revokeObjectURL(url);
    }

    // -------------------------------
    // Initialization
    // -------------------------------
    (function init(){
      // wire nav
      $$('.nav button').forEach(b=>b.addEventListener('click', ()=>{ $$('.nav button').forEach(x=>x.classList.remove('active')); b.classList.add('active'); }));
      render();
    })();

  </script>
</body>
</html>
